{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <link rel="manifest" href="{% static 'manifest.json' %}">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Idea Manager">
    <meta name="theme-color" content="#4a5568">

    <link rel="apple-touch-icon" href="{% static 'img/icon-192x192.png' %}">

    <title>{% block title %}Idea Manager{% endblock %}</title>
    {% tailwind_css %}
  </head>
  <body class="bg-slate-100 flex flex-col h-full">
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 bg-purple-950 text-white p-2"
      >Skip to main content</a
    >

    <header class="bg-purple-950 p-4 text-white">{% include 'includes/nav.html' %}</header>

    <main id="main-content" class="container mx-auto my-16 px-4 shrink-0">
      {% block content %}{% endblock %}
    </main>

    <footer class="bg-slate-950 text-white mt-auto px-12 py-8">

    </footer>

    <!-- Logout confirmation -->
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
          const logoutForm = document.querySelector('form[action="{% url 'logout' %}"]');
          if (logoutForm) {
              logoutForm.addEventListener('submit', function(e) {
                  e.preventDefault();
                  if (confirm('Are you sure you want to log out?')) {
                      this.submit();
                  }
              });
          }
      });
    </script>

    <!-- Mobile Menu Helper -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const navToggle = document.getElementById('nav-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = navToggle.querySelector('svg:first-child');
        const closeIcon = navToggle.querySelector('svg:last-child');
    
        function openMenu() {
          mobileMenu.classList.remove('-translate-x-full');
          navToggle.setAttribute('aria-expanded', 'true');
          menuIcon.classList.add('opacity-0');
          closeIcon.classList.remove('opacity-0');
        }
    
        function closeMenu() {
          mobileMenu.classList.add('-translate-x-full');
          navToggle.setAttribute('aria-expanded', 'false');
          menuIcon.classList.remove('opacity-0');
          closeIcon.classList.add('opacity-0');
        }
    
        navToggle.addEventListener('click', function(e) {
          e.stopPropagation();
          if (mobileMenu.classList.contains('-translate-x-full')) {
            openMenu();
          } else {
            closeMenu();
          }
        });
    
        document.addEventListener('click', function(event) {
          if (!mobileMenu.contains(event.target) && !navToggle.contains(event.target)) {
            closeMenu();
          }
        });
    
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 1024) {
            closeMenu();
          }
        });
      });
    </script>
    
    <!-- Service worker register -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/static/service-worker.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>   
    
    <!-- App install prompt -->
    <script>
      let deferredPrompt;

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        // Show your custom "Add to Home Screen" button or banner here
      });

      // When the user clicks your custom button:
      installButton.addEventListener('click', (e) => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('User accepted the A2HS prompt');
            }
            deferredPrompt = null;
          });
        }
      });
    </script>

    <!-- Offline sync Trigger when back online -->
    <script>
      window.addEventListener('online', () => {
        navigator.serviceWorker.ready.then((swRegistration) => {
          return swRegistration.sync.register('sync-ideas');
        });
      })
    </script>
      
    {% block extra_js %}{% endblock %}
  </body>
</html>
